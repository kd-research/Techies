<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta content="width=640, height=960, user-scalable=no" name="viewport" />
    <title>Wordsmith Workshop</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-image: url("https://opengameart.org/sites/default/files/background_8.png");
        background-size: cover;
        background-position: center;
      }

      .active {
        display: block !important;
      }

      .screen {
        display: none;
        width: 100%;
        height: 100vh;
        position: absolute;
        top: 0;
        left: 0;
      }

      #start-menu-screen .container {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
      }
      #start-menu-screen .container #game-title {
        font-size: 48px;
        margin-bottom: 40px;
        color: #fff;
        text-shadow: 2px 2px #000;
      }
      #start-menu-screen .container button {
        background-color: #c9a46c;
        border: none;
        padding: 15px 30px;
        font-size: 24px;
        cursor: pointer;
        border-radius: 10px;
        margin: 10px;
        transition: background-color 0.3s;
        color: #fff;
      }
      #start-menu-screen .container button:hover {
        background-color: #a67c52;
      }

      #settings-screen .container,
      #instructions-screen .container,
      #game-over-screen .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        color: #fff;
        padding: 20px;
        text-align: center;
      }
      #settings-screen .container button,
      #instructions-screen .container button,
      #game-over-screen .container button {
        background-color: #c9a46c;
        border: none;
        padding: 10px 20px;
        font-size: 20px;
        cursor: pointer;
        border-radius: 5px;
        margin-top: 20px;
        color: #fff;
      }
      #settings-screen .container button:hover,
      #instructions-screen .container button:hover,
      #game-over-screen .container button:hover {
        background-color: #a67c52;
      }

      #game-container .container {
        width: 100%;
        height: 100%;
        position: relative;
        overflow: hidden;
        background-color: rgba(255, 255, 255, 0.9);
        padding: 20px;
      }

      #game-container .game-stats,
      #game-container .customer-orders,
      #game-container .letter-tiles,
      #game-container .crafted-item,
      #game-container .shop {
        margin-bottom: 20px;
      }

      #game-container .customer-orders h2,
      #game-container .crafted-item h2,
      #game-container .game-stats h2,
      #game-container .shop h2 {
        margin-bottom: 10px;
      }

      .letter-tile {
        display: inline-block;
        width: 40px;
        height: 40px;
        line-height: 40px;
        margin: 5px;
        background-color: #f5deb3;
        text-align: center;
        font-size: 24px;
        font-weight: bold;
        border: 2px solid #8b5a2b;
        border-radius: 5px;
        cursor: pointer;
      }

      .letter-tile.selected {
        background-color: #deb887;
      }

      #crafted-word {
        font-size: 32px;
        margin-top: 10px;
      }

      #submit-word-button,
      #shuffle-button,
      #swap-tile-button,
      #buy-letter-button {
        margin-top: 10px;
        padding: 10px 20px;
        font-size: 20px;
        margin-right: 10px;
      }

      /* Timer Style */
      #timer {
        font-size: 24px;
        margin-bottom: 10px;
      }

      /* Back to Menu Button */
      #back-to-menu-button {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: #c9a46c;
        border: none;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
        border-radius: 5px;
        color: #fff;
      }
      #back-to-menu-button:hover {
        background-color: #a67c52;
      }

      /* Responsive Design */
      @media screen and (max-width: 768px) {
        #start-menu-screen .container #game-title {
          font-size: 36px;
        }
        #start-menu-screen .container button {
          font-size: 20px;
          padding: 12px 24px;
        }
        .letter-tile {
          width: 30px;
          height: 30px;
          line-height: 30px;
          font-size: 20px;
        }
        #crafted-word {
          font-size: 24px;
        }
      }
    </style>
  </head>
  <body>
    <div class="active screen" id="start-menu-screen">
      <div class="container">
        <h1 id="game-title">Wordsmith Workshop</h1>
        <button id="play-button">Play</button>
        <button id="settings-button">Settings</button>
        <button id="instructions-button">Instructions</button>
      </div>
    </div>
    <!-- Mode Selection Screen -->
    <div class="screen" id="mode-selection-screen">
      <div class="container">
        <h2>Select Game Mode</h2>
        <button id="normal-mode-button">Normal Mode</button>
        <button id="timer-mode-button">Timer Mode</button>
        <button class="main-menu-button" id="mode-back-button">Back</button>
      </div>
    </div>
    <div class="screen" id="settings-screen">
      <div class="container">
        <!-- Volume Control -->
        <label for="volume-control">Volume:</label>
        <input
          type="range"
          id="volume-control"
          min="0"
          max="1"
          step="0.01"
          value="0.5"
        />
        <button class="main-menu-button" id="setting-back-button">Back</button>
      </div>
    </div>
    <div class="screen" id="instructions-screen">
      <div class="container">
        <!-- Instructions Content -->
        <h2>Instructions</h2>
        <p>
          Welcome to <strong>Wordsmith Workshop</strong>! As the village's
          master craftsman, you are tasked with fulfilling orders for weapons,
          armor, and enchanted items.
        </p>
        <p>
          Use the letter tiles to form words. The words you create will
          determine the attributes of the items you craft.
        </p>
        <ul>
          <li>
            <strong>Elemental Letters:</strong> Certain letters correspond to
            elements (e.g., 'F' for fire, 'W' for water).
          </li>
          <li>
            <strong>Length & Complexity:</strong> Longer words create more
            powerful items with additional effects.
          </li>
          <li>
            <strong>Durability:</strong> Affected by the word's length and use
            of strong consonants.
          </li>
          <li>
            <strong>Magic Effects:</strong> Specific words or letter
            combinations imbue items with special powers.
          </li>
        </ul>
        <p>
          Balance your time between crafting, upgrading your workshop, and
          serving customers. Satisfy customers to improve your reputation and
          attract more business!
        </p>
        <button class="main-menu-button" id="instructions-back-button">
          Back
        </button>
      </div>
    </div>
    <div class="screen" id="game-container">
      <button id="back-to-menu-button">Back to Menu</button>
      <div class="container">
        <!-- Game Content -->
        <div class="game-stats">
          <p><strong>Reputation:</strong> <span id="reputation">0</span></p>
          <p><strong>Gold:</strong> <span id="gold">100</span> coins</p>
        </div>
        <div id="timer"></div>
        <div class="customer-orders">
          <h2>Customer Orders</h2>
          <p id="current-order">Loading order...</p>
        </div>
        <div class="letter-tiles">
          <h2>Available Letters</h2>
          <div id="letters-container"></div>
        </div>
        <div class="crafted-item">
          <h2>Crafted Item</h2>
          <p id="crafted-word"></p>
          <button id="submit-word-button">Craft Item</button>
        </div>
        <div class="shop">
          <h2>Shop</h2>
          <button id="shuffle-button">Shuffle Tiles (Cost: 10)</button>
          <button id="swap-tile-button">Swap a Tile (Cost: 15)</button>
          <button id="buy-letter-button">Buy Extra Tile (Cost: 20)</button>
        </div>
      </div>
    </div>
    <div class="screen" id="game-over-screen">
      <div class="container">
        <div id="game-over-message">Game Over!</div>
        <button id="play-again-button">Play Again</button>
        <button class="main-menu-button" id="game-over-main-menu-button">
          Main Menu
        </button>
      </div>
    </div>
    <!-- Audio Elements -->
    <audio autoplay id="background-music" loop>
      <source
        src="https://opengameart.org/sites/default/files/Medieval_Theme.ogg"
        type="audio/ogg"
      />
    </audio>
    <audio id="start-game-sound">
      <source
        src="https://opengameart.org/sites/default/files/Start_Game_Sound.ogg"
        type="audio/ogg"
      />
    </audio>
    <audio id="craft-item-sound">
      <source
        src="https://opengameart.org/sites/default/files/Craft_Item_Sound.ogg"
        type="audio/ogg"
      />
    </audio>
    <!-- Additional audio elements -->
    <audio id="error-sound">
      <source
        src="https://opengameart.org/sites/default/files/Error_Sound.ogg"
        type="audio/ogg"
      />
    </audio>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        class GameUI {
          constructor() {
            this.startMenuScreen = document.getElementById("start-menu-screen");
            this.settingsScreen = document.getElementById("settings-screen");
            this.instructionsScreen = document.getElementById(
              "instructions-screen"
            );
            this.gameContainer = document.getElementById("game-container");
            this.gameOverScreen = document.getElementById("game-over-screen");
            this.modeSelectionScreen = document.getElementById(
              "mode-selection-screen"
            );
            this.backgroundMusic = document.getElementById("background-music");
            this.volumeControl = document.getElementById("volume-control");
            this.backToMenuButton = document.getElementById(
              "back-to-menu-button"
            );
            this.initVolumeControl();
          }

          initVolumeControl() {
            this.backgroundMusic.volume = this.volumeControl.value;
            this.volumeControl.addEventListener("input", () => {
              this.backgroundMusic.volume = this.volumeControl.value;
              const audios = document.querySelectorAll("audio");
              audios.forEach((audio) => {
                audio.volume = this.volumeControl.value;
              });
            });
          }

          swapToScreen(screen) {
            const screens = document.querySelectorAll(".screen");
            screens.forEach((scr) => scr.classList.remove("active"));
            screen.classList.add("active");
          }

          startGame() {
            const startGameSound = document.getElementById("start-game-sound");
            this.swapToScreen(this.modeSelectionScreen);
            startGameSound.play();
          }

          beginGameplay() {
            this.swapToScreen(this.gameContainer);
          }

          endGame() {
            this.swapToScreen(this.gameOverScreen);
          }

          mainMenu() {
            this.swapToScreen(this.startMenuScreen);
          }

          playAgain() {
            this.swapToScreen(this.gameContainer);
          }

          settings() {
            this.swapToScreen(this.settingsScreen);
          }

          instructions() {
            this.swapToScreen(this.instructionsScreen);
          }
        }

        class GameLogic {
          constructor(ui, mode) {
            this.ui = ui;
            this.mode = mode;
            this.availableLetters = [];
            this.selectedLetters = [];
            this.currentWord = "";
            this.reputation = 0;
            this.gold = 100;
            this.currentOrder = "";
            this.orders = [
              "Sword",
              "Shield",
              "Helmet",
              "Armor",
              "Potion",
              "Amulet",
              "Ring",
              "Boots",
            ];
            this.lettersPool = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            this.vowels = ["A", "E", "I", "O", "U"];
            this.letterValues = {
              A: 1,
              B: 3,
              C: 3,
              D: 2,
              E: 1,
              F: 4,
              G: 2,
              H: 4,
              I: 1,
              J: 8,
              K: 5,
              L: 1,
              M: 3,
              N: 1,
              O: 1,
              P: 3,
              Q: 10,
              R: 1,
              S: 1,
              T: 1,
              U: 1,
              V: 4,
              W: 4,
              X: 8,
              Y: 4,
              Z: 10,
            };
            this.timerInterval = null;
            this.timeLeft = 60; // seconds
            this.wordList = [];
            this.loadWordList();
            this.initGame();
          }

          async loadWordList() {
            const response = await fetch(
              "https://raw.githubusercontent.com/dwyl/english-words/master/words_alpha.txt"
            );
            const text = await response.text();
            this.wordList = text
              .split("\n")
              .map((word) => word.trim().toUpperCase());
          }

          initGame() {
            this.updateStats();
            this.generateOrder();
            this.generateLetters();
            this.displayLetters();
            this.updateCraftedWord();
            this.assignCraftButton();
            this.assignShopButtons();
            if (this.mode === "timer") {
              this.startTimer();
            }
            this.ui.backToMenuButton.addEventListener("click", () => {
              clearInterval(this.timerInterval);
              this.ui.mainMenu();
            });
          }

          startTimer() {
            const timerElement = document.getElementById("timer");
            timerElement.innerText = `Time Left: ${this.timeLeft}s`;
            this.timerInterval = setInterval(() => {
              this.timeLeft--;
              timerElement.innerText = `Time Left: ${this.timeLeft}s`;
              if (this.timeLeft <= 0) {
                clearInterval(this.timerInterval);
                alert("Time is up!");
                this.ui.endGame();
              }
            }, 1000);
          }

          updateStats() {
            document.getElementById("reputation").innerText = this.reputation;
            document.getElementById("gold").innerText = this.gold;
          }

          generateOrder() {
            const randomIndex = Math.floor(Math.random() * this.orders.length);
            this.currentOrder = this.orders[randomIndex];
            document.getElementById(
              "current-order"
            ).innerText = `Customer requests a ${this.currentOrder}`;
          }

          generateLetters(extraLetters = 0) {
            this.availableLetters = [];
            const totalLetters = 12 + extraLetters;

            // Ensure at least 3 vowels
            for (let i = 0; i < 3; i++) {
              const randomVowel =
                this.vowels[Math.floor(Math.random() * this.vowels.length)];
              this.availableLetters.push(randomVowel);
            }

            // Fill the rest of the letters
            for (let i = 3; i < totalLetters; i++) {
              const randomLetter =
                this.lettersPool[
                  Math.floor(Math.random() * this.lettersPool.length)
                ];
              this.availableLetters.push(randomLetter);
            }

            // Shuffle the letters
            this.availableLetters = this.availableLetters.sort(
              () => Math.random() - 0.5
            );
          }

          displayLetters() {
            const lettersContainer =
              document.getElementById("letters-container");
            lettersContainer.innerHTML = "";
            this.availableLetters.forEach((letter, index) => {
              const letterTile = document.createElement("div");
              letterTile.classList.add("letter-tile");
              letterTile.innerText = letter;
              letterTile.addEventListener("click", () =>
                this.selectLetter(index, letterTile)
              );
              lettersContainer.appendChild(letterTile);
            });
          }

          selectLetter(index, tileElement) {
            if (!this.selectedLetters.includes(index)) {
              this.selectedLetters.push(index);
              tileElement.classList.add("selected");
            } else {
              this.selectedLetters.splice(
                this.selectedLetters.indexOf(index),
                1
              );
              tileElement.classList.remove("selected");
            }
            this.updateCraftedWord();
          }

          updateCraftedWord() {
            this.currentWord = this.selectedLetters
              .map((i) => this.availableLetters[i])
              .join("");
            document.getElementById("crafted-word").innerText =
              this.currentWord;
          }

          assignCraftButton() {
            const craftButton = document.getElementById("submit-word-button");
            craftButton.addEventListener("click", () => this.craftItem());
          }

          assignShopButtons() {
            const shuffleButton = document.getElementById("shuffle-button");
            const swapTileButton = document.getElementById("swap-tile-button");
            const buyLetterButton =
              document.getElementById("buy-letter-button");

            shuffleButton.addEventListener("click", () => this.shuffleTiles());
            swapTileButton.addEventListener("click", () => this.swapTile());
            buyLetterButton.addEventListener("click", () =>
              this.buyExtraTile()
            );
          }

          shuffleTiles() {
            const cost = 10;
            if (this.gold >= cost) {
              this.gold -= cost;
              this.updateStats();
              this.availableLetters = this.availableLetters.sort(
                () => Math.random() - 0.5
              );
              this.displayLetters();
            } else {
              alert("Not enough gold to shuffle tiles.");
            }
          }

          swapTile() {
            const cost = 15;
            if (this.gold >= cost) {
              const tileIndex = prompt(
                "Enter the position (1-" +
                  this.availableLetters.length +
                  ") of the tile to swap:"
              );
              const index = parseInt(tileIndex) - 1;
              if (index >= 0 && index < this.availableLetters.length) {
                this.gold -= cost;
                this.updateStats();
                const randomLetter =
                  this.lettersPool[
                    Math.floor(Math.random() * this.lettersPool.length)
                  ];
                this.availableLetters[index] = randomLetter;
                this.displayLetters();
              } else {
                alert("Invalid tile position.");
              }
            } else {
              alert("Not enough gold to swap a tile.");
            }
          }

          buyExtraTile() {
            const cost = 20;
            if (this.gold >= cost) {
              this.gold -= cost;
              this.updateStats();
              const randomLetter =
                this.lettersPool[
                  Math.floor(Math.random() * this.lettersPool.length)
                ];
              this.availableLetters.push(randomLetter);
              this.displayLetters();
            } else {
              alert("Not enough gold to buy an extra tile.");
            }
          }

          async craftItem() {
            if (this.currentWord.length === 0) {
              alert("Please select letters to form a word.");
              return;
            }

            // Validate the word
            if (!this.wordList.includes(this.currentWord.toUpperCase())) {
              const errorSound = document.getElementById("error-sound");
              errorSound.play();
              alert("Invalid word. Please try again.");
              return;
            }

            const craftItemSound = document.getElementById("craft-item-sound");
            craftItemSound.play();

            // Calculate item attributes
            const durability = this.calculateDurability();
            const magicEffect = this.calculateMagicEffect();
            const itemValue =
              this.currentWord.length * 10 + durability * 2 + magicEffect.value;

            // Update game stats
            this.gold += itemValue;
            this.reputation += 1;

            alert(
              `Crafted a ${this.currentOrder} with durability ${durability} and ${magicEffect.effect}. Sold for ${itemValue} coins!`
            );

            // Reset for next order
            this.selectedLetters = [];
            this.currentWord = "";
            this.updateCraftedWord();
            this.generateOrder();
            this.generateLetters();
            this.displayLetters();
            this.updateStats();
          }

          calculateDurability() {
            const strongConsonants = ["B", "C", "D", "G", "K", "P", "Q", "T"];
            let durability = this.currentWord.length;
            for (const letter of this.currentWord.toUpperCase()) {
              if (strongConsonants.includes(letter)) {
                durability += 2;
              }
            }
            return durability;
          }

          calculateMagicEffect() {
            const elementalLetters = {
              F: "Fire",
              W: "Water",
              E: "Earth",
              A: "Air",
            };
            let effect = "No magic effect";
            let value = 0;
            for (const letter of this.currentWord.toUpperCase()) {
              if (elementalLetters[letter]) {
                effect = `${elementalLetters[letter]} enchantment`;
                value += 20;
              }
            }
            return { effect, value };
          }
        }

        class Game {
          constructor() {
            this.ui = new GameUI();
            this.logic = null;
            this.assignButtons();
          }

          prepareGame() {
            // Prepare game elements if necessary
          }

          startGame() {
            this.ui.startGame();
          }

          beginGameplay(mode) {
            this.ui.beginGameplay();
            this.logic = new GameLogic(this.ui, mode);
          }

          resetGame() {
            this.logic = new GameLogic(this.ui, this.logic.mode);
          }

          assignButtons() {
            const playButton = document.getElementById("play-button");
            const settingsButton = document.getElementById("settings-button");
            const instructionsButton = document.getElementById(
              "instructions-button"
            );
            const playAgainButton =
              document.getElementById("play-again-button");
            const mainMenuButtons =
              document.querySelectorAll(".main-menu-button");
            const normalModeButton =
              document.getElementById("normal-mode-button");
            const timerModeButton =
              document.getElementById("timer-mode-button");

            settingsButton.addEventListener(
              "click",
              this.ui.settings.bind(this.ui)
            );
            instructionsButton.addEventListener(
              "click",
              this.ui.instructions.bind(this.ui)
            );
            playAgainButton.addEventListener("click", () => {
              this.ui.playAgain();
              this.resetGame();
            });
            mainMenuButtons.forEach((button) =>
              button.addEventListener("click", this.ui.mainMenu.bind(this.ui))
            );
            playButton.addEventListener("click", this.startGame.bind(this));
            normalModeButton.addEventListener("click", () =>
              this.beginGameplay("normal")
            );
            timerModeButton.addEventListener("click", () =>
              this.beginGameplay("timer")
            );
          }
        }

        const game = new Game();
        game.prepareGame();
      });
    </script>
  </body>
</html>
